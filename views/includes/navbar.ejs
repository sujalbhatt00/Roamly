<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roamly - Find Your Perfect Stay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- General Reset & Base Styles --- */
        :root {
            --roamly-red: #FF385C;
            --roamly-dark-red: #E03E44;
            --roamly-light-gray: #f7f7f7;
            --roamly-border-gray: #dddddd;
            --roamly-text-dark: #222222;
            --roamly-text-medium: #717171;
            --roamly-shadow-light: rgba(0,0,0,0.08);
            --roamly-shadow-medium: rgba(0,0,0,0.18);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Circular', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #fff;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* --- Navbar Container & Sticky Behavior --- */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1050; /* Higher than offcanvas */
            width: 100%;
            background-color: #ffffff;
            border-bottom: 1px solid #ebebeb;
            transition: box-shadow 0.3s ease;
            padding: 0; /* Remove default padding */
        }

        .navbar.scrolled {
            box-shadow: 0 1px 8px var(--roamly-shadow-light);
        }

        .navbar-desktop-content {
            display: grid;
            grid-template-columns: 1fr auto 1fr; /* Logo/Explore | Search | Auth */
            align-items: center;
            height: 100px; /* MODIFIED: Increased navbar height */
            padding: 0 max(80px, 5vw); /* MODIFIED: Dynamic padding for better full-width appearance */
            gap: 24px;
            /* Removed max-width to allow elements to size dynamically */
            margin: 0 auto; /* Still center if content is smaller than viewport - but elements can now grow */
        }

        /* --- Logo & Explore Link (Desktop) --- */
        .navbar-brand-col {
            display: flex;
            align-items: center;
            justify-self: start;
            flex-shrink: 0;
        }

        .roamly-logo {
            text-decoration: none;
            font-size: 5rem; /* MODIFIED: Made logo even bigger */
            font-weight: 700;
            margin-left: auto;
            color: var(--roamly-red); /* Darker red */
            letter-spacing: -0.5px;
            white-space: nowrap; /* Keep logo on one line */
        }


        
        .explore-link {
            text-decoration: none;
            color: var(--roamly-text-dark);
            font-size: 16px;
            font-weight: 600;
            padding: 12px 16px;
            margin-left: 19px; /* Space from logo */
            border-radius: 22px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .explore-link:hover {
            background-color: var(--roamly-light-gray);
        }

        /* --- Search Bar (Desktop) --- */
        .navbar-search-col {
            display: flex;
            justify-content: center;
            justify-self: center; /* Center in its grid column */
            width: 100%;
            max-width: 850px; /* Kept this for overall max, but search-container now controls its size more */
        }

        .search-container {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 700px; /* MODIFIED: Made search bar even longer */
            border: 1px solid var(--roamly-border-gray);
            border-radius: 40px;
            padding: 8px 8px 8px 24px;
            transition: all 0.2s ease;
            background: #ffffff;
            box-shadow: 0 1px 2px var(--roamly-shadow-light);
        }

        .search-container:hover {
            box-shadow: 0 2px 4px var(--roamly-shadow-medium);
        }

        .search-container:focus-within {
            box-shadow: 0 3px 12px var(--roamly-shadow-light);
        }

        .search-input {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            font-size: 14px;
            color: var(--roamly-text-dark);
            font-weight: 400;
        }

        .search-input::placeholder {
            color: var(--roamly-text-medium);
        }

        .search-btn {
            background: var(--roamly-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .search-btn:hover {
            transform: scale(1.04);
            box-shadow: 0 4px 8px rgba(255, 56, 92, 0.3);
            background: var(--roamly-dark-red);
        }

        .search-btn:active {
            transform: scale(0.96);
        }

        /* --- Auth Links (Desktop) --- */
        .navbar-auth-col {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-self: end;
            flex-shrink: 0;
        }

        .host-link {
            text-decoration: none;
            color: var(--roamly-text-dark);
            font-size: 14px;
            font-weight: 600;
            padding: 12px 16px;
            border-radius: 22px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .host-link:hover {
            background-color: var(--roamly-light-gray);
        }

        .auth-links {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 8px 8px 16px;
            border: 1px solid var(--roamly-border-gray);
            border-radius: 21px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #ffffff;
        }

        .auth-links:hover {
            box-shadow: 0 2px 4px var(--roamly-shadow-medium);
        }

        .auth-text-link {
            text-decoration: none;
            color: var(--roamly-text-dark);
            font-size: 14px;
            font-weight: 600;
            transition: color 0.2s ease;
            white-space: nowrap;
        }

        .auth-text-link:hover {
            color: var(--roamly-red);
        }

        .auth-user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Placeholder color */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }
        .auth-user-avatar svg {
            width: 16px;
            height: 16px;
        }
        /* --- Mobile Navbar (d-lg-none) --- */
        .navbar-mobile-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px; /* MODIFIED: Taller height for mobile */
            padding: 0 24px; /* Mobile padding */
            gap: 12px;
        }

        .mobile-logo {
            font-size: 2.2rem; /* MODIFIED: Adjusted mobile logo size */
            color: var(--roamly-red);
            font-weight: 700;
            text-decoration: none;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .mobile-search-pill {
            flex-grow: 1; /* Takes up available space */
            flex-shrink: 1;
            min-width: 0; /* Allow shrinking */
            border: 1px solid var(--roamly-border-gray);
            border-radius: 24px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #fff;
            box-shadow: 0 1px 2px var(--roamly-shadow-light);
            cursor: pointer;
            transition: box-shadow 0.2s ease;
        }
        .mobile-search-pill:hover {
            box-shadow: 0 2px 4px var(--roamly-shadow-medium);
        }
        .mobile-search-pill i {
            color: var(--roamly-text-dark);
            font-size: 1rem;
        }
        .mobile-search-pill span {
            color: var(--roamly-text-medium);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- Hamburger Menu Icon (Mobile) --- */
        .navbar-toggler {
            border: none;
            padding: 0.25rem 0.5rem;
            font-size: 1.25rem;
            line-height: 1;
            background-color: transparent;
            border-radius: 0.375rem;
            transition: box-shadow 0.15s ease-in-out;
            cursor: pointer;
            flex-shrink: 0; /* Prevents it from shrinking */
        }
        .navbar-toggler-icon {
            display: inline-block;
            width: 1.5em; /* Standard Bootstrap size */
            height: 1.5em;
            vertical-align: middle;
            background-image: var(--bs-navbar-toggler-icon-bg);
            background-repeat: no-repeat;
            background-position: center;
            background-size: 100%;
        }
        /* Using Bootstrap's custom toggler icon */
        .navbar-toggler {
            --bs-navbar-toggler-icon-bg: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='%23444' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }


        /* --- Offcanvas Menu (Mobile) --- */
        .offcanvas {
            --bs-offcanvas-width: 280px;
            background-color: #fff;
            z-index: 1051; /* Higher than navbar */
            border: none;
        }
        .offcanvas-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--roamly-border-gray);
        }
        .offcanvas-title {
            color: var(--roamly-red);
            font-size: 1.5rem;
            font-weight: 700;
        }
        .offcanvas-body {
            padding: 0.5rem 0;
        }
        .offcanvas-link {
            display: block;
            padding: 1rem 1.5rem;
            color: var(--roamly-text-dark);
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .offcanvas-link:hover {
            background-color: var(--roamly-light-gray);
            color: var(--roamly-red);
        }
        .offcanvas-divider {
            border-top: 1px solid var(--roamly-light-gray);
            margin: 0.5rem 0;
        }

        /* --- Blur Overlay --- */
        .blur-overlay {
            position: fixed;
            top: 0; 
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1040; /* Lower than offcanvas, higher than page content */
            background-color: rgba(0, 0, 0, 0.1); 
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .blur-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* --- Responsive Adjustments --- */
        /* Tablet/Small Laptop (e.g., iPad Pro portrait) */
        @media (max-width: 1200px) {
            .navbar-desktop-content {
                padding: 0 max(40px, 3vw); /* Reduced dynamic padding for smaller screens */
                gap: 16px;
                height: 90px; /* MODIFIED: Adjusted tablet navbar height */
            }
            .roamly-logo {
                font-size: 4rem; /* MODIFIED: Adjusted logo size for smaller desktops */
            }
            .explore-link {
                padding: 8px 12px;
                font-size: 15px;
            }
            .search-container {
                max-width: 500px; /* Adjusted search bar length for smaller desktops */
            }
            .host-link, .auth-text-link {
                font-size: 13px;
                padding: 10px 14px;
            }
            .auth-links {
                padding: 6px 6px 6px 14px;
                gap: 10px;
            }
            .auth-user-avatar {
                width: 28px;
                height: 28px;
            }
            .auth-user-avatar svg {
                width: 14px;
                height: 14px;
            }
        }

        /* Mobile / Smaller Tablet (below 992px) */
        @media (max-width: 991.98px) {
            .navbar-desktop-content {
                display: none; /* Hide desktop content */
            }
            .navbar-mobile-content {
                display: flex; /* Show mobile content */
            }
        }

        @media (max-width: 767.98px) {
            .navbar-mobile-content {
                height: 64px; /* MODIFIED: Adjusted mobile navbar height */
                padding: 0 16px;
                gap: 8px;
            }
            .mobile-logo {
                font-size: 2.2rem; /* MODIFIED: Adjusted mobile logo size */
            }
            .mobile-search-pill {
                padding: 6px 10px;
            }
            .mobile-search-pill i {
                font-size: 0.9rem;
            }
            .mobile-search-pill span {
                font-size: 0.8rem;
            }
            .offcanvas {
                --bs-offcanvas-width: 250px;
            }
        }

        @media (max-width: 420px) {
            .mobile-logo {
                font-size: 2rem; /* MODIFIED: Adjusted mobile logo size */
            }
            .mobile-search-pill span {
                display: none; /* Hide search text on very small screens */
            }
        }

    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <!-- --- Desktop Navbar (Visible on Large Screens - d-none d-lg-flex) --- --><div class="d-none d-lg-grid navbar-desktop-content w-100">
            
            <div class="navbar-brand-col">
                <a class="roamly-logo" m style="font-weight: bold;margin-left:auto; font-size: 1.5rem;" href="/listings"><B>ROAMLY</B></a>
                <a class="explore-link" href="/listings">Explore</a>
            </div>

            <div class="navbar-search-col">
             <form class="search-container" action="/listings/search" method="get" autocomplete="off" style="width:100%; max-width:700px;">
  <input type="text" name="q" class="search-input" placeholder="Search destination..." id="navbar-search-input">
  <button type="submit" class="search-btn"><i class="fa fa-search"></i></button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("navbar-search-input");
  let suggestionBox;

  input.addEventListener("input", async function() {
    const q = input.value.trim();
    if (q.length < 1) {
      if (suggestionBox) suggestionBox.remove();
      return;
    }
    // Fetch suggestions from backend
    const res = await fetch(`/listings/search?q=${encodeURIComponent(q)}&ajax=1`);
    const data = await res.json();
    if (!suggestionBox) {
      suggestionBox = document.createElement("div");
      suggestionBox.className = "search-suggestions";
      input.parentNode.appendChild(suggestionBox);
    }
    suggestionBox.innerHTML = "";
    data.forEach(listing => {
      const item = document.createElement("div");
      item.className = "suggestion-item";
      item.textContent = `${listing.title} (${listing.location}, ${listing.country})`;
      item.onclick = () => window.location.href = `/listings/${listing._id}`;
      suggestionBox.appendChild(item);
    });
    if (data.length === 0) {
      suggestionBox.innerHTML = "<div class='suggestion-item'>No results found</div>";
    }
  });

  document.addEventListener("click", function(e) {
    if (suggestionBox && !input.contains(e.target)) suggestionBox.remove();
  });
});
</script>
<style>
.search-suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: #fff;
  border: 1px solid #eee;
  z-index: 9999;
  max-height: 260px;
  overflow-y: auto;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}
.suggestion-item {
  padding: 0.7rem 1rem;
  cursor: pointer;
  font-size: 1rem;
  border-bottom: 1px solid #f3f3f3;
}
.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover { background: #f7f7f7; }
</style>
            </div>

            <div class="navbar-auth-col">
                <a class="host-link" href="/listings/new">Roamly your home</a>
                <div class="auth-links" onclick="toggleOffcanvas()">
                    <!-- User Status based on EJS logic --><% if(!currUser){ %>
                        <a class="auth-text-link" href="/signup">Sign Up</a>
                        <a class="auth-text-link" href="/login">Login</a>
                    <% } else { %>
                        <a class="auth-text-link" href="/logout">Logout</a>
                    <% } %>
                    <div class="auth-user-avatar">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- --- Mobile Navbar (Visible on Small Screens - d-lg-none) --- --><div class="d-lg-none w-100">
            <div class="navbar-mobile-content">
                <a class="mobile-logo" style="font-weight: bold; font-size: 1.5rem;" href="/listings"><B>ROAMLY</B></a>
                
                <div class="mobile-search-pill">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <span>Search destinations</span>
                </div>

                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation" onclick="toggleBlur()">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- --- Offcanvas Menu (Mobile Only) --- --><div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" data-bs-scroll="true">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" onclick="toggleBlur()"></button>
        </div>
        <div class="offcanvas-body">
            <div>
                <a class="offcanvas-link" href="/explore">Explore</a>
                <a class="offcanvas-link" href="/listings/new">Roamly your home</a>
            </div>
           
            <div>
                 <% if(!currUser){ %>
                    <a class="offcanvas-link" href="/signup">Sign Up</a>
                    <a class="offcanvas-link" href="/login">Login</a>
                <% } else { %>
                    <a class="offcanvas-link" href="/logout">Logout</a>
                <% } %>
            </div>
        </div>
    </div>

    <!-- --- Blur Overlay --- --><div class="blur-overlay" id="blur-overlay"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const offcanvasNavbar = document.getElementById('offcanvasNavbar');
        const blurOverlay = document.getElementById('blur-overlay');
        const navbar = document.querySelector('.navbar');

        function toggleBlur() {
            if (offcanvasNavbar.classList.contains('show')) {
                blurOverlay.classList.remove('active');
            } else {
                blurOverlay.classList.add('active');
            }
        }

        // Add event listener to hide blur when offcanvas is hidden
        offcanvasNavbar.addEventListener('hide.bs.offcanvas', () => {
            blurOverlay.classList.remove('active');
        });
        
        // Add event listener to show blur when offcanvas is shown (just in case)
        offcanvasNavbar.addEventListener('show.bs.offcanvas', () => {
            blurOverlay.classList.add('active');
        });


        // Scroll effect for navbar shadow
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Basic search functionality (for demo)
        document.querySelector('.mobile-search-pill').addEventListener('click', () => {
            alert('Mobile search clicked!');
            // You can redirect to a search page or open a modal here
        });

        document.querySelector('.search-container').addEventListener('submit', (e) => {
            e.preventDefault();
            const query = document.querySelector('.search-input').value;
            if (query) {
                alert('Searching for: ' + query);
                // window.location.href = `/listings/search?q=${encodeURIComponent(query)}`;
            }
        });

        // Example for dynamic auth links (EJS logic is usually handled server-side)
        // For a client-side demo, you might simulate login/logout
        function simulateAuthToggle() {
            // This part is typically handled by server-side EJS
            // For a pure HTML/JS demo, you'd swap content based on a JS variable
        }
        // simulateAuthToggle(); // Call if you want to test client-side swapping
    </script>
</body>
</html>

